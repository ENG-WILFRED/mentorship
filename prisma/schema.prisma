// Prisma schema for a full-featured church app
// Includes users, roles, sermons, events, feedback, attendance, donations, groups, and more

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  email     String   @unique
  password  String
  role      Role     @default(GUEST)
  createdAt DateTime @default(now())
  mentor    Mentor?
  feedbacks Feedback[]
  sermons   Sermon[]
  sermonComments SermonComment[]
  sermonReactions SermonReaction[]
  memorableId String @unique
}

enum Role {
  STUDENT
  MENTOR
  ADMIN
  GUEST
}

model Mentor {
  id        Int      @id @default(autoincrement())
  name      String
  bio       String?
  location  String?
  age       Int?
  education String?
  maritalStatus String?
  phone     String?
  email     String?
  experience Int?
  skills    String?
  user      User?    @relation(fields: [userId], references: [id])
  userId    Int? @unique
  missions  MissionMentor[]
}

model School {
  id        Int      @id @default(autoincrement())
  name      String
  location  String
  gender    String
  population Int
  contact   String?
  logo      String?
  missions  MissionSchool[]

  Report Report[]
}

model Mission {
  id        Int      @id @default(autoincrement())
  title     String
  date      DateTime
  status    MissionStatus @default(UPCOMING)
  description String?
  goals     String?
  outcomes  String?
  notes     String?
  students  Int
  topic     String
  mentors   MissionMentor[]
  schools   MissionSchool[]
  reports   Report[]
  media     Media[]
}

enum MissionStatus {
  UPCOMING
  ONGOING
  COMPLETED
}

model MissionMentor {
  mission   Mission @relation(fields: [missionId], references: [id])
  missionId Int
  mentor    Mentor  @relation(fields: [mentorId], references: [id])
  mentorId  Int
  @@id([missionId, mentorId])
}

model MissionSchool {
  mission   Mission @relation(fields: [missionId], references: [id])
  missionId Int
  school    School  @relation(fields: [schoolId], references: [id])
  schoolId  Int
  @@id([missionId, schoolId])
}

model Report {
  id        Int      @id @default(autoincrement())
  mission   Mission  @relation(fields: [missionId], references: [id])
  missionId Int
  school    School   @relation(fields: [schoolId], references: [id])
  schoolId  Int
  date      DateTime
  topic     String
  students  Int
  outcome   String
}

model Media {
  id        Int      @id @default(autoincrement())
  url       String
  caption   String?
  mission   Mission? @relation(fields: [missionId], references: [id])
  missionId Int?
}

model Feedback {
  id        Int      @id @default(autoincrement())
  message   String
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
  userId    Int?
}

model Sermon {
  id          Int               @id @default(autoincrement())
  title       String
  description String?
  videoUrl    String?
  audioUrl    String?
  coverImage  String?
  topic       String?
  author      String?
  createdAt   DateTime          @default(now())
  createdBy   User?             @relation(fields: [createdById], references: [id])
  createdById Int?
  comments    SermonComment[]
  reactions   SermonReaction[]
}

model SermonComment {
  id        Int      @id @default(autoincrement())
  sermon    Sermon   @relation(fields: [sermonId], references: [id])
  sermonId  Int
  user      User?    @relation(fields: [userId], references: [id])
  userId    Int?
  message   String
  createdAt DateTime @default(now())
}

model SermonReaction {
  id        Int      @id @default(autoincrement())
  sermon    Sermon   @relation(fields: [sermonId], references: [id])
  sermonId  Int
  user      User?    @relation(fields: [userId], references: [id])
  userId    Int?
  emoji     String
  createdAt DateTime @default(now())

  @@unique([sermonId, userId, emoji])
}
